<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aiden_OS v4.1 | Titanium Stable</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2ff;
            --bg: #020202;
            --card: rgba(20, 20, 20, 0.95);
            --border: rgba(255, 255, 255, 0.1);
            --text: #ffffff;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; cursor: crosshair; user-select: none; }
        body { font-family: 'Space Grotesk', sans-serif; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }

        /* --- BOOT SEQUENCE --- */
        #boot-screen {
            position: fixed; inset: 0; background: #000; z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 1s ease;
        }
        .boot-text { font-family: 'Fira Code'; color: var(--primary); margin-top: 20px; font-size: 0.8rem; letter-spacing: 2px; }

        /* --- LOGIN --- */
        #login-screen {
            position: fixed; inset: 0; background: radial-gradient(circle at center, #111, #000);
            z-index: 9999; display: none; align-items: center; justify-content: center;
        }
        .login-box { text-align: center; padding: 40px; border: 1px solid var(--border); border-radius: 24px; background: rgba(0,0,0,0.8); width: 320px; backdrop-filter: blur(20px); }
        .avatar { width: 80px; height: 80px; background: var(--primary); border-radius: 50%; margin: 0 auto 20px; box-shadow: 0 0 30px var(--primary); border: 4px solid #fff; }

        /* --- UI ELEMENTS --- */
        #os-interface { display: none; height: 100vh; flex-direction: column; }
        nav { height: 65px; display: flex; justify-content: space-between; align-items: center; padding: 0 30px; border-bottom: 1px solid var(--border); background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); z-index: 1000; }
        
        .nav-links { display: flex; gap: 5px; }
        .nav-btn { background: transparent; border: 1px solid transparent; color: #777; padding: 10px 20px; cursor: pointer; font-weight: 700; border-radius: 8px; transition: 0.3s; }
        .nav-btn.active { color: var(--primary); border-color: rgba(0, 242, 255, 0.3); background: rgba(0, 242, 255, 0.05); text-shadow: 0 0 10px var(--primary); }

        #desktop { display: flex; flex: 1; position: relative; overflow: hidden; background-image: radial-gradient(rgba(255,255,255,0.03) 1px, transparent 1px); background-size: 40px 40px; }
        
        /* Sidebar */
        .sidebar { width: 90px; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 25px; background: rgba(0,0,0,0.6); z-index: 5; }
        .desktop-icon { text-align: center; width: 75px; font-size: 0.6rem; padding: 12px 5px; border-radius: 12px; transition: 0.2s; color: #aaa; }
        .desktop-icon:hover { background: rgba(255,255,255,0.05); color: #fff; }

        /* Draggable Nodes */
        .file-node {
            position: absolute; width: 90px; text-align: center; padding: 10px;
            border-radius: 8px; border: 1px solid transparent; z-index: 10;
        }
        .file-node:hover { background: rgba(255,255,255,0.05); border-color: var(--border); }
        .file-node.selected { background: rgba(0, 242, 255, 0.1); border-color: var(--primary); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }
        .file-node div { font-size: 2.2rem; margin-bottom: 5px; }
        .file-node span { font-size: 0.7rem; font-weight: 500; display: block; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

        /* Context Menu */
        #ctx-menu {
            position: fixed; background: #121212; border: 1px solid #333; 
            border-radius: 8px; padding: 6px 0; z-index: 10001; display: none;
            width: 170px; box-shadow: 0 15px 40px rgba(0,0,0,0.8);
        }
        .ctx-item { padding: 10px 18px; font-size: 0.8rem; color: #ccc; cursor: pointer; }
        .ctx-item:hover { background: var(--primary); color: #000; font-weight: bold; }

        /* VISUALIZER */
        #viz-container { width: 100%; height: 80px; display: flex; align-items: flex-end; gap: 2px; margin-bottom: 20px; }
        .viz-bar { flex: 1; background: var(--primary); min-height: 2px; }

        /* Pages (Menu Overlays) */
        .page-overlay { position: absolute; inset: 0; padding: 40px; background: rgba(5,5,5,0.95); display: none; z-index: 100; overflow-y: auto; backdrop-filter: blur(10px); }
        .page-overlay.active { display: block; animation: slideUp 0.3s ease-out; }

        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        footer { height: 35px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; padding: 0 20px; font-size: 0.7rem; font-family: 'Fira Code'; color: #444; background: #000; z-index: 1000; }
    </style>
</head>
<body oncontextmenu="handleGlobalCtx(event)">

    <div id="boot-screen" onclick="initKernel()">
        <div class="avatar" style="width:100px; height:100px; filter: grayscale(1);"></div>
        <div style="font-size: 1.2rem; font-weight: bold; letter-spacing: 4px;">AIDEN_OS</div>
        <div class="boot-text" id="boot-status">TAP TO BOOT</div>
    </div>

    <div id="login-screen">
        <div class="login-box">
            <div class="avatar"></div>
            <h3 style="margin-bottom: 20px;">Welcome, Aiden</h3>
            <input type="password" id="pw" placeholder="PASSWORD" style="background:#111; border:1px solid #333; color:#fff; padding:12px; border-radius:8px; width:100%; text-align:center; outline:none;" onkeypress="if(event.key==='Enter') unlock()">
            <p style="font-size: 0.6rem; opacity: 0.3; margin-top: 15px;">HINT: JUST PRESS ENTER</p>
        </div>
    </div>

    <div id="ctx-menu">
        <div class="ctx-item" onclick="createNewFile()">New Text Document</div>
        <div class="ctx-item" onclick="createNewFile('üìÇ', 'New Folder')">New Folder</div>
        <div class="ctx-item" onclick="location.reload()">Restart System</div>
    </div>

    <div id="os-interface">
        <nav>
            <div style="font-weight: 700; letter-spacing: 1px;">SYSTEM_<span style="color:var(--primary)">ROOT</span></div>
            <div class="nav-links">
                <button class="nav-btn active" id="btn-desktop" onclick="showDesktop()">DESKTOP</button>
                <button class="nav-btn" id="btn-music" onclick="openMenu('music')">MUSIC</button>
                <button class="nav-btn" id="btn-themes" onclick="openMenu('themes')">THEMES</button>
            </div>
            <div id="clock" style="font-family:'Fira Code'; font-weight: bold;">00:00:00</div>
        </nav>

        <main id="desktop" ondragover="allowDrop(event)" ondrop="handleDrop(event)" onclick="deselectAll()">
            <div class="sidebar">
                <div class="desktop-icon" onclick="showDesktop()">
                    <div style="font-size:1.8rem">üè†</div>Home
                </div>
                <div class="desktop-icon" id="trash-bin" ondragover="allowDrop(event)" ondrop="handleTrash(event)">
                    <div style="font-size:1.8rem">üóëÔ∏è</div>Trash
                </div>
            </div>

            <div id="music-page" class="page-overlay">
                <h1 style="border-bottom: 2px solid var(--primary); display: inline-block; margin-bottom: 20px;">Audio Engine</h1>
                <div id="viz-container"></div>
                <div id="music-list"></div>
            </div>

            <div id="themes-page" class="page-overlay">
                <h1 style="border-bottom: 2px solid var(--primary); display: inline-block; margin-bottom: 20px;">Visual Modules</h1>
                <div id="theme-grid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap:15px; margin-top:20px;"></div>
            </div>

            </main>

        <footer>
            <div id="sys-msg">STATUS: READY</div>
            <div id="sys-stats">DISK: 44% | RAM: 1.4GB</div>
        </footer>
    </div>

    <script>
        let audioCtx, analyser, dataArray, source;

        // --- BOOT ---
        function initKernel() {
            document.getElementById('boot-status').innerText = "INITIALIZING...";
            
            // Chime only, no voice
            const audio = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audio.createOscillator();
            const gain = audio.createGain();
            osc.connect(gain); gain.connect(audio.destination);
            osc.frequency.setValueAtTime(220, audio.currentTime);
            osc.frequency.exponentialRampToValueAtTime(880, audio.currentTime + 0.8);
            gain.gain.setValueAtTime(0.1, audio.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audio.currentTime + 0.8);
            osc.start(); osc.stop(audio.currentTime + 1);

            setTimeout(() => {
                document.getElementById('boot-screen').style.opacity = '0';
                setTimeout(() => {
                    document.getElementById('boot-screen').style.display = 'none';
                    document.getElementById('login-screen').style.display = 'flex';
                }, 800);
            }, 1200);
        }

        function unlock() {
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('os-interface').style.display = 'flex';
            initVisualizer();
            spawnFile(150, 100, "Portfolio.pdf", "üìÑ");
            spawnFile(150, 220, "Source_Code", "üìÇ");
        }

        // --- NAVIGATION (FIXED) ---
        function showDesktop() {
            document.querySelectorAll('.page-overlay').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById('btn-desktop').classList.add('active');
            updateLog("Desktop Focus");
        }

        function openMenu(menuId) {
            document.querySelectorAll('.page-overlay').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(menuId + '-page').classList.add('active');
            document.getElementById('btn-' + menuId).classList.add('active');
            updateLog("Opening " + menuId.toUpperCase());
        }

        // --- FILE SYSTEM ---
        let fileCount = 0;
        function spawnFile(x, y, name, icon) {
            fileCount++;
            const div = document.createElement('div');
            div.className = 'file-node';
            div.id = 'f-' + fileCount;
            div.draggable = true;
            div.style.left = x + 'px';
            div.style.top = y + 'px';
            div.innerHTML = `<div>${icon}</div><span>${name}</span>`;
            
            div.onclick = (e) => { e.stopPropagation(); deselectAll(); div.classList.add('selected'); };
            div.ondragstart = (e) => { e.dataTransfer.setData("text", e.target.id); };
            div.ondblclick = () => alert(`System File: ${name}\nStatus: Read-Only`);

            document.getElementById('desktop').appendChild(div);
        }

        function createNewFile(icon = "üìÑ", name = "New_File") {
            const x = Math.random() * 200 + 150;
            const y = Math.random() * 200 + 100;
            spawnFile(x, y, name + "_" + fileCount, icon);
            hideCtx();
        }

        function deselectAll() { document.querySelectorAll('.file-node').forEach(f => f.classList.remove('selected')); }

        // --- DRAG / DROP / TRASH ---
        function allowDrop(e) { e.preventDefault(); }
        function handleDrop(e) {
            e.preventDefault();
            const id = e.dataTransfer.getData("text");
            const el = document.getElementById(id);
            if(el) {
                el.style.left = e.clientX - 45 + 'px';
                el.style.top = e.clientY - 45 + 'px';
            }
        }
        function handleTrash(e) {
            e.preventDefault();
            const id = e.dataTransfer.getData("text");
            const el = document.getElementById(id);
            if(el) {
                el.remove();
                updateLog("File moved to trash");
            }
        }

        // --- CONTEXT MENU ---
        function handleGlobalCtx(e) {
            e.preventDefault();
            const menu = document.getElementById('ctx-menu');
            menu.style.display = 'block';
            menu.style.left = e.clientX + 'px';
            menu.style.top = e.clientY + 'px';
        }
        function hideCtx() { document.getElementById('ctx-menu').style.display = 'none'; }
        document.addEventListener('click', hideCtx);

        // --- MUSIC & VIZ ---
        const tracks = [
            { t: "Smells Like Teen Spirit", a: "Nirvana", f: "music/nirvana.mp3", i: "https://upload.wikimedia.org/wikipedia/en/b/b7/NirvanaNevermindalbumcover.jpg" },
            { t: "On Melancholy Hill", a: "Gorillaz", f: "music/gorillaz.mp3", i: "https://upload.wikimedia.org/wikipedia/en/d/d1/Plasticbeach452.jpg" },
            { t: "American Idiot", a: "Green Day", f: "music/greenday.mp3", i: "https://upload.wikimedia.org/wikipedia/en/e/ed/Green_Day_-_American_Idiot_album_cover.png" }
        ];

        function initVisualizer() {
            const container = document.getElementById('viz-container');
            for(let i=0; i<64; i++) {
                const bar = document.createElement('div');
                bar.className = 'viz-bar';
                container.appendChild(bar);
            }
        }

        function setupAudio(el) {
            if(!audioCtx) {
                audioCtx = new AudioContext();
                analyser = audioCtx.createAnalyser();
                analyser.fftSize = 128;
                dataArray = new Uint8Array(analyser.frequencyBinCount);
            }
            if(source) source.disconnect();
            source = audioCtx.createMediaElementSource(el);
            source.connect(analyser); analyser.connect(audioCtx.destination);
            renderViz();
        }

        function renderViz() {
            analyser.getByteFrequencyData(dataArray);
            const bars = document.querySelectorAll('.viz-bar');
            bars.forEach((b, i) => { b.style.height = (dataArray[i] / 2.5) + 'px'; });
            requestAnimationFrame(renderViz);
        }

        const mList = document.getElementById('music-list');
        tracks.forEach(tr => {
            const d = document.createElement('div');
            d.style.cssText = "display:flex; align-items:center; gap:20px; background:rgba(255,255,255,0.05); padding:15px; border-radius:12px; margin-bottom:10px; border: 1px solid var(--border);";
            d.innerHTML = `<img src="${tr.i}" style="width:50px; border-radius:6px;">
                           <div style="flex:1"><b>${tr.t}</b><br><small style="color:#666">${tr.a}</small></div>
                           <audio controls src="${tr.f}" onplay="setupAudio(this)" style="filter:invert(1)"></audio>`;
            mList.appendChild(d);
        });

        // --- THEMES ---
        const themeList = [
            {n:"Nirvana", c:"#00f2ff"}, {n:"Vaporwave", c:"#ff71ce"}, {n:"Matrix", c:"#00ff41"}, 
            {n:"Classic Red", c:"#ff4444"}, {n:"Amber", c:"#ffb000"}, {n:"Ghost White", c:"#ffffff"}
        ];
        const tGrid = document.getElementById('theme-grid');
        themeList.forEach(t => {
            const box = document.createElement('div');
            box.style.cssText = "background:#111; padding:20px; border-radius:15px; border:1px solid #333; text-align:center; cursor:pointer";
            box.innerHTML = `<div style="height:35px; background:${t.c}; border-radius:8px; margin-bottom:10px"></div>${t.n}`;
            box.onclick = () => { document.documentElement.style.setProperty('--primary', t.c); updateLog("Theme: " + t.n); };
            tGrid.appendChild(box);
        });

        function updateLog(m) { document.getElementById('sys-msg').innerText = "STATUS: " + m.toUpperCase(); }
        setInterval(() => { document.getElementById('clock').innerText = new Date().toLocaleTimeString(); }, 1000);
    </script>
</body>
</html>
